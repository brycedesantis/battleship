(()=>{"use strict";const t=function(t,e){const n={id:t,length:e,hits:[],sunk:!1,direction:"horizontal"};function r(){if(n.hits.length===n.length)return n.sunk=!0,n.sunk}return{stats:n,hit:function(t){n.hits.push(t),r()},getHits:function(){return n.hits},isSunk:r,getDirection:function(){return n.direction},changeDirection:function(){"horizontal"===n.direction?n.direction="vertical":n.direction="horizontal"}}},e=function(e="computer"){return{name:e,fleet:{Carrier:t("carrier",5),Battleship:t("battleship",4),Destroyer:t("destroyer",3),Submarine:t("submarine",3),Patrol:t("patrol",2)},attack:function(t,e,n){n.receiveAttack(t,e)},randomAttack:function t(e){let n=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());const a=e.getOcean()[n][r];"miss"===a||"hit"===a?t(e):e.receiveAttack(n,r)}}},n=()=>{let t=Array(10).fill("ocean").map((()=>Array(10).fill("ocean"))),n=[];function r(t,e,n,r){let a=t,i=e+n;return"vertical"===r&&(a=t+n,i=e),[a,i]}function a(e,a,i){const o=t,c=e.getDirection(),l=function(e,n,a,i){const o=[];for(let c=0;c<a;c++){const[a,l]=r(e,n,c,i);if(!(a<10&&l<10))return!1;o.push(t[a][l])}return o.every((t=>"ocean"===t))}(a,i,e.stats.length,c);if(l){for(let t=0;t<e.stats.length;t++){const[n,l]=r(a,i,t,c);o[n][l]={ship:e,index:t}}return n.push(e),l}return l}function i(t){let e=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());Math.random()>.5&&t.changeDirection(),a(t,e,n)||i(t)}return{getOcean:function(){return t},atPosition:function(e,n){return t[e][n]},placeShip:a,receiveAttack:function(e,n){return"ocean"===t[e][n]?(t[e][n]="miss",n):(t[e][n].ship&&(t[e][n].ship.hit(t[e][n].index),t[e][n]="hit"),t[e][n])},allSunk:function(){return n.every((t=>t.isSunk()))},allPlaced:function(){return n.length===Object.keys(e().fleet).length},autoPlaceFleet:function(t){for(const e in t)i(t[e])},resetOcean:function(){t=Array(10).fill("ocean").map((()=>Array(10).fill("ocean"))),n=[]}}},r=function(){const t=(t,e,n)=>`<div class='gamesquare ${n}' data-y=${t} data-x=${e}></div>`;return{makeBoard:function(e,n,r){e.textContent="";const a=n.getOcean(),i=a.length;let o="";for(let e=0;e<i;e++)for(let n=0;n<i;n++){let i=a[e][n];"ocean"===i?i="ocean":i.ship&&(i="computer"!==r.name?i.ship.stats.id:"ocean"),o+=t(e,n,i)}e.insertAdjacentHTML("afterbegin",o)}}},a=function(){const t=e("player 1"),a=e(),i=n(),o=n(),c=document.querySelector(".player-grid"),l=document.querySelector(".computer-grid");function u(){r().makeBoard(c,i,t.fleet),r().makeBoard(l,o,a.fleet)}function s(e){let n=e.target;if(n.classList.contains("gamesquare")){const e=n.dataset.y,r=n.dataset.x,a=o.getOcean()[e][r];"miss"!==a&&"hit"!==a&&(t.attack(e,r,o),u())}}return{player1:t,player2:a,player1Board:i,player2Board:o,renderBoard:u,autoPlace:function(){i.resetOcean(),o.resetOcean(),i.autoPlaceFleet(t.fleet),o.autoPlaceFleet(a.fleet),u()},clickEvents:function(){l.addEventListener("click",s)}}}();a.autoPlace(),a.clickEvents()})();