(()=>{"use strict";const t=function(t,e){const n={id:t,length:e,hits:[],sunk:!1,direction:"horizontal"};function r(){if(n.hits.length===n.length)return n.sunk=!0,n.sunk}return{stats:n,hit:function(t){n.hits.push(t),r()},getHits:function(){return n.hits},isSunk:r,getDirection:function(){return n.direction},changeDirection:function(){"horizontal"===n.direction?n.direction="vertical":n.direction="horizontal"}}},e=function(e="computer"){return{name:e,fleet:{Carrier:t("carrier",5),Battleship:t("battleship",4),Destroyer:t("destroyer",3),Submarine:t("submarine",3),Patrol:t("patrol",2)},attack:function(t,e,n){n.receiveAttack(t,e)},randomAttack:function t(e){let n=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());const a=e.getOcean()[n][r];"miss"===a||"hit"===a?t(e):e.receiveAttack(n,r)}}},n=()=>{let t=Array(10).fill("ocean").map((()=>Array(10).fill("ocean"))),n=[];function r(t,e,n,r){let a=t,c=e+n;return"vertical"===r&&(a=t+n,c=e),[a,c]}function a(e,a,c){const i=t,o=e.getDirection(),l=function(e,n,a,c){const i=[];for(let o=0;o<a;o++){const[a,l]=r(e,n,o,c);if(!(a<10&&l<10))return!1;i.push(t[a][l])}return i.every((t=>"ocean"===t))}(a,c,e.stats.length,o);if(l){for(let t=0;t<e.stats.length;t++){const[n,l]=r(a,c,t,o);i[n][l]={ship:e,index:t}}return n.push(e),l}return l}function c(t){let e=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());Math.random()>.5&&t.changeDirection(),a(t,e,n)||c(t)}return{getOcean:function(){return t},atPosition:function(e,n){return t[e][n]},placeShip:a,receiveAttack:function(e,n){return"ocean"===t[e][n]?(t[e][n]="miss",n):(t[e][n].ship&&(t[e][n].ship.hit(t[e][n].index),t[e][n]="hit"),t[e][n])},allSunk:function(){return n.every((t=>t.isSunk()))},allPlaced:function(){return n.length===Object.keys(e().fleet).length},autoPlaceFleet:function(t){for(const e in t)c(t[e])},resetOcean:function(){t=Array(10).fill("ocean").map((()=>Array(10).fill("ocean"))),n=[]}}},r=function(){const t=(t,e,n)=>`<div class='gamesquare ${n}' data-y=${t} data-x=${e}></div>`;return{makeBoard:function(e,n,r){e.textContent="";const a=n.getOcean(),c=a.length;let i="";for(let e=0;e<c;e++)for(let n=0;n<c;n++){let c=a[e][n];"ocean"===c?c="ocean":c.ship&&(c="computer"!==r.name?c.ship.stats.id:"ocean"),i+=t(e,n,c)}e.insertAdjacentHTML("afterbegin",i)},renderShipYard:function(t){const e=document.querySelector(".ship-yard");for(const n in t){const r=document.createElement("div");r.className="yard";let a="";for(let e=0;e<t[n].stats.length;e++)a+=`\n\t\t\t\t<div class='gamesquare ${t[n].stats.id}' id='yard-ships' data-index=${e}></div>\n\t\t\t\t`;r.innerHTML=`<p>${t[n].stats.id}</p>\n\t\t\t<div class='ship'>\n\t\t\t${a}\n\t\t\t</div>\n\t\t\t`,e.append(r)}}}},a=function(){const t=e("Player 1"),a=e(),c=n(),i=n(),o=document.querySelector(".player-grid"),l=document.querySelector(".computer-grid");function s(){r().makeBoard(o,c,t.fleet),r().makeBoard(l,i,a.fleet)}function u(e){let n=e.target;if(c.allPlaced()&&n.classList.contains("gamesquare")){const e=n.dataset.y,r=n.dataset.x,o=i.getOcean()[e][r];if("miss"!==o&&"hit"!==o&&(t.attack(e,r,i),a.randomAttack(c),s()),i.allSunk()||c.allSunk()){let e=i.allSunk()?t.name:a.name;const n=document.querySelector(".game-over-screen"),r=document.querySelector(".end-screen");document.querySelector(".main").classList.add("blur"),n.style.display="flex",r.innerHTML=`\n\t\t\t\t\t<h1>GAME OVER</h1>\n\t\t\t\t\t<h3>${e} WINS!</h3>\n\t\t\t\t\t`}}}const d=document.querySelector("button");return{player1:t,player2:a,player1Board:c,player2Board:i,renderBoard:s,autoPlace:function(){c.resetOcean(),i.resetOcean(),i.autoPlaceFleet(a.fleet),s()},clickEvents:function(){l.addEventListener("click",u),d.addEventListener("click",(()=>{event.preventDefault(),function(){let e=document.querySelector("select").value,n=parseInt(document.querySelector("#inner-location").value),r=parseInt(document.querySelector("#outer-location").value),a=document.querySelector("#ship-direction").value,i=t.fleet[e];"vertical"===a&&i.changeDirection(),c.placeShip(i,r,n),s()}()}))},renderShipYard:function(){r().renderShipYard(t.fleet)}}}();a.autoPlace(),a.clickEvents(),a.renderShipYard()})();