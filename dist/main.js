(()=>{"use strict";const e=function(e,t){const n={id:e,length:t,hits:[],sunk:!1,direction:"horizontal"};function r(){if(n.hits.length===n.length)return n.sunk=!0,n.sunk}return{stats:n,hit:function(e){n.hits.push(e),r()},getHits:function(){return n.hits},isSunk:r,getDirection:function(){return n.direction},changeDirection:function(){"horizontal"===n.direction?n.direction="vertical":n.direction="horizontal"}}},t=function(t="computer"){return{name:t,fleet:{Carrier:e("carrier",5),Battleship:e("battleship",4),Destroyer:e("destroyer",3),Submarine:e("submarine",3),Patrol:e("patrol",2)},attack:function(e,t,n){n.receiveAttack(e,t)},randomAttack:function e(t){let n=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());const a=t.getOcean()[n][r];"miss"===a||"hit"===a?e(t):t.receiveAttack(n,r)}}},n=()=>{let e=Array(10).fill("ocean").map((()=>Array(10).fill("ocean"))),n=[];function r(e,t,n,r){let a=e,c=t+n;return"vertical"===r&&(a=e+n,c=t),[a,c]}function a(t,a,c){const o=e,i=t.getDirection(),l=function(t,n,a,c){const o=[];for(let i=0;i<a;i++){const[a,l]=r(t,n,i,c);if(!(a<10&&l<10))return!1;o.push(e[a][l])}return o.every((e=>"ocean"===e))}(a,c,t.stats.length,i);if(l){for(let e=0;e<t.stats.length;e++){const[n,l]=r(a,c,e,i);o[n][l]={ship:t,index:e}}return n.push(t),l}return l}function c(e){let t=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());Math.random()>.5&&e.changeDirection(),a(e,t,n)||c(e)}return{getOcean:function(){return e},atPosition:function(t,n){return e[t][n]},placeShip:a,receiveAttack:function(t,n){return"ocean"===e[t][n]?(e[t][n]="miss",n):(e[t][n].ship&&(e[t][n].ship.hit(e[t][n].index),e[t][n]="hit"),e[t][n])},allSunk:function(){return n.every((e=>e.isSunk()))},allPlaced:function(){return n.length===Object.keys(t().fleet).length},autoPlaceFleet:function(e){for(const t in e)c(e[t])},resetOcean:function(){e=Array(10).fill("ocean").map((()=>Array(10).fill("ocean"))),n=[]}}},r=function(){const e=(e,t,n)=>`<div class='gamesquare ${n}' data-y=${e} data-x=${t}></div>`;return{makeBoard:function(t,n,r){t.textContent="";const a=n.getOcean(),c=a.length;let o="";for(let t=0;t<c;t++)for(let n=0;n<c;n++){let c=a[t][n];"ocean"===c?c="ocean":c.ship&&(c="computer"!==r.name?c.ship.stats.id:"ocean"),o+=e(t,n,c)}t.insertAdjacentHTML("afterbegin",o)},renderShipYard:function(e){const t=document.querySelector(".ship-yard");for(const n in e){const r=document.createElement("div");r.className="yard";let a="";for(let t=0;t<e[n].stats.length;t++)a+=`\n\t\t\t\t<div class='gamesquare ${e[n].stats.id}' id='yard-ships' data-index=${t}></div>\n\t\t\t\t`;r.innerHTML=`<p>${e[n].stats.id}</p>\n\t\t\t<div class='ship'>\n\t\t\t${a}\n\t\t\t</div>\n\t\t\t`,t.append(r)}}}},a=function(){const e=t("Player 1"),a=t(),c=n(),o=n(),i=document.querySelector(".player-grid"),l=document.querySelector(".computer-grid");function s(){r().makeBoard(i,c,e.fleet),r().makeBoard(l,o,a.fleet)}function u(){c.resetOcean(),o.resetOcean(),o.autoPlaceFleet(a.fleet),s()}function d(t){let n=t.target;if(c.allPlaced()&&n.classList.contains("gamesquare")){const t=n.dataset.y,r=n.dataset.x,i=o.getOcean()[t][r];if("miss"!==i&&"hit"!==i&&(e.attack(t,r,o),a.randomAttack(c),s()),o.allSunk()||c.allSunk()){let t=o.allSunk()?e.name:a.name;const n=document.querySelector(".game-over-screen"),r=document.querySelector("#winner-message");document.querySelector(".main").classList.add("blur"),n.style.display="flex",r.textContent=`${t} WINS!`}}}const f=document.querySelector("#place-ship-btn"),h=document.querySelector("#restart-game");return{player1:e,player2:a,player1Board:c,player2Board:o,renderBoard:s,autoPlace:u,clickEvents:function t(){l.addEventListener("click",d),f.addEventListener("click",(()=>{event.preventDefault(),function(){let t=document.querySelector("select").value,n=parseInt(document.querySelector("#inner-location").value),r=parseInt(document.querySelector("#outer-location").value),a=document.querySelector("#ship-direction").value,o=e.fleet[t];"vertical"===a&&o.changeDirection(),c.placeShip(o,r,n),s()}()})),h.addEventListener("click",(()=>{event.preventDefault(),function(){const n=document.querySelector(".game-over-screen"),r=document.querySelector(".main");n.style.display="none",r.classList.remove("blur");for(const t in e.fleet)e.fleet[t].stats.sunk=!1,e.fleet[t].stats.hits=[],a.fleet[t].stats.sunk=!1,a.fleet[t].stats.hits=[];u(),t()}()}))},renderShipYard:function(){r().renderShipYard(e.fleet)}}}();a.autoPlace(),a.clickEvents(),a.renderShipYard()})();