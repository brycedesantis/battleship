(()=>{"use strict";const t=function(t,e){const n={id:t,length:e,hits:[],sunk:!1,direction:"horizontal"};function r(){if(n.hits.length===n.length)return n.sunk=!0,n.sunk}return{stats:n,hit:function(t){n.hits.push(t),r()},getHits:function(){return n.hits},isSunk:r,getDirection:function(){return n.direction},changeDirection:function(){"horizontal"===n.direction?n.direction="vertical":n.direction="horizontal"}}},e=function(e="computer"){return{name:e,fleet:{Carrier:t("carrier",5),Battleship:t("battleship",4),Destroyer:t("destroyer",3),Submarine:t("submarine",3),Patrol:t("patrol",2)},attack:function(t,e,n){n.receiveAttack(t,e)},randomAttack:function t(e){let n=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());const a=e.getOcean()[n][r];"miss"===a||"hit"===a?t(e):e.receiveAttack(n,r)}}},n=()=>{let t=Array(10).fill("ocean").map((()=>Array(10).fill("ocean"))),n=[];function r(t,e,n,r){let a=t,i=e+n;return"vertical"===r&&(a=t+n,i=e),[a,i]}function a(e,a,i){const c=t,o=e.getDirection(),s=function(e,n,a,i){const c=[];for(let o=0;o<a;o++){const[a,s]=r(e,n,o,i);if(!(a<10&&s<10))return!1;c.push(t[a][s])}return c.every((t=>"ocean"===t))}(a,i,e.stats.length,o);if(s){for(let t=0;t<e.stats.length;t++){const[n,s]=r(a,i,t,o);c[n][s]={ship:e,index:t}}return n.push(e),s}return s}function i(t){let e=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());Math.random()>.5&&t.changeDirection(),a(t,e,n)||i(t)}return{getOcean:function(){return t},atPosition:function(e,n){return t[e][n]},placeShip:a,receiveAttack:function(e,n){return"ocean"===t[e][n]?(t[e][n]="miss",n):(t[e][n].ship&&(t[e][n].ship.hit(t[e][n].index),t[e][n]="hit"),t[e][n])},allSunk:function(){return n.every((t=>t.isSunk()))},allPlaced:function(){return n.length===Object.keys(e().fleet).length},autoPlaceFleet:function(t){for(const e in t)i(t[e])},resetOcean:function(){t=Array(10).fill("ocean").map((()=>Array(10).fill("ocean"))),n=[]}}},r=function(){const t=(t,e,n)=>`<div class='gamesquare ${n}' data-y=${t} data-x=${e}></div>`;return{makeBoard:function(e,n,r){e.textContent="";const a=n.getOcean(),i=a.length;let c="";for(let e=0;e<i;e++)for(let n=0;n<i;n++){let i=a[e][n];"ocean"===i?i="ocean":i.ship&&(i="computer"!==r.name?i.ship.stats.id:"ocean"),c+=t(e,n,i)}e.insertAdjacentHTML("afterbegin",c)},renderShipYard:function(t){const e=document.querySelector(".ship-yard");for(const n in t){const r=document.createElement("div");r.className="yard";let a="";for(let e=0;e<t[n].stats.length;e++)a+=`\n\t\t\t\t<div class='gamesquare ${t[n].stats.id}' id='yard-ships' data-index=${e}></div>\n\t\t\t\t`;r.innerHTML=`<p>${t[n].stats.id}</p>\n\t\t\t<div class='ship'>\n\t\t\t${a}\n\t\t\t</div>\n\t\t\t`,e.append(r)}}}},a=function(){const t=e("player 1"),a=e(),i=n(),c=n(),o=document.querySelector(".player-grid"),s=document.querySelector(".computer-grid");function l(){r().makeBoard(o,i,t.fleet),r().makeBoard(s,c,a.fleet)}function u(e){let n=e.target;if(n.classList.contains("gamesquare")){const e=n.dataset.y,r=n.dataset.x,o=c.getOcean()[e][r];if("miss"!==o&&"hit"!==o&&(t.attack(e,r,c),a.randomAttack(i),l()),c.allSunk()||i.allSunk()){let e=c.allSunk()?t.name:a.name;const n=document.querySelector(".game-over-screen"),r=document.querySelector(".end-screen");document.querySelector(".main").classList.add("blur"),n.style.display="flex",r.innerHTML=`\n\t\t\t\t<h1>GAME OVER</h1>\n\t\t\t\t<h3>${e} WINS!</h3>\n\t\t\t\t`}}}return{player1:t,player2:a,player1Board:i,player2Board:c,renderBoard:l,autoPlace:function(){i.resetOcean(),c.resetOcean(),i.autoPlaceFleet(t.fleet),c.autoPlaceFleet(a.fleet),l()},clickEvents:function(){s.addEventListener("click",u)},renderShipYard:function(){r().renderShipYard(t.fleet)}}}();a.autoPlace(),a.clickEvents(),a.renderShipYard()})();